<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>منيو مطعم ورد</title>

  <!-- أيقونة الموقع -->
  <link rel="icon" href="photos/logo.png" type="image/x-icon">

  <!-- ملف التصميم الخارجي -->
  <link rel="stylesheet" href="style.css">

  <!-- ملف المانيفست الخاص بالتطبيق -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#551665">

  <!-- دعم Android أيضًا -->
  <meta name="mobile-web-app-capable" content="yes">

  <!-- دعم التثبيت على iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="photos/logo.png">

  <style>
    /* --- تنسيقات زر التثبيت --- */
    #installBtn {
      background: #551665;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      display: none; /* مخفي افتراضيًا */
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 10000;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    #installBtn:hover {
      background: #3f104c;
    }

    /* تمييز الزر المختار */
    .category.selected {
      background: #551665;
      color: white;
    }

    /* ملاحظة تثبيت خاصة بـ iOS (ستظهر فقط على Safari في iOS) */
    #iosInstallHint {
      display: none;
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 9999;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 12px 16px;
      border-radius: 10px;
      color: white;
      font-size: 14px;
    }

    /* (باقي تنسيقات الصفحة كما كانت لديك) */
  </style>
</head>

<body>
  <!-- زر التثبيت اليدوي: يظهر فقط عندما يُطلق beforeinstallprompt -->
  <button id="installBtn">📲 تثبيت التطبيق</button>

  <!-- ملاحظة تثبيت خاصة بـ iOS -->
  <div id="iosInstallHint">
    لتثبيت التطبيق: اضغط على زر <b>المشاركة</b> ثم اختر <b>"إضافة إلى الشاشة الرئيسية"</b>.
  </div>

  <!-- بداية محتوى الصفحة -->
  <div class="page-frame">
    <!-- الشريط العلوي -->
    <div class="header" style="position: relative; height: 250px;">
      <img src="photos/logo.png" alt="Logo" class="logo-img">
      <div class="logo-text">
        مطعم وكافيه "ورد" يقدم تجربة طعام صحية وشهية بمكونات طبيعية طازجة.
        نستخدم زيت الزيتون ونغسل الخضروات بعناية لضمان نظافتها.
        نبتعد عن المنكهات الصناعية والملح الصيني،
        ونعتمد أدوات طهي صحية ومعايير نظافة عالمية.
        صور أطباقنا واقعية كما تُقدَّم، لأن الأمانة تبدأ من المطبخ.
      </div>
    </div>

    <!-- شريط البحث -->
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="بحث...">
      <button onclick="search()">🔍</button>
    </div>

    <!-- القائمة الأفقية -->
    <div class="category-scroll">
      <div class="categories">
        <button class="category selected">🥗<br>الافطار</button>
        <button class="category">🥪<br>الساندويتشات</button>
        <button class="category">🍕<br>البيتزا</button>
        <button class="category">🌱<br>السلطات</button>
        <button class="category">🍲<br>الشوربات</button>
        <button class="category">🍽️<br>الاطباق</button>
        <button class="category">👶<br>وجبات الاطفال</button>
        <button class="category">🍰<br>الحلويات</button>
        <button class="category">🥤<br>المشروبات البارده</button>
        <button class="category">☕️<br>المشروبات الساخنة</button>
        <button class="category">💨<br>الشيش</button>
      </div>
    </div>

    <!-- قسم الطعام (يتم ملؤه ديناميكيًا) -->
    <div id="food-list"></div>

    <!-- أزرار التنقل السفلية -->
    <nav class="bottom-nav">
      <a href="fedback.html" aria-label="صفحة الفيدباك">
        <button type="button">
          <div class="location">
            <img src="photos/qusition.png" alt="feedback" class="location-img" width="20" height="20">
          </div>
        </button>
      </a>
      <a href="map.html" aria-label="صفحة الموقع">
        <button type="button">
          <div class="location">
            <img src="photos/location.png" alt="location" class="location-img" width="20" height="20">
          </div>
        </button>
      </a>
    </nav>
  </div>

  <!-- سكربت عرض البيانات وتعامل الـ PWA -->
  <script>
    // ----------------------
    // 1. تسجيل Service Worker
    // ----------------------
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => {
            console.log('✅ تم تسجيل Service Worker:', reg);
          })
          .catch(err => {
            console.error('❌ فشل تسجيل Service Worker:', err);
          });
      });
    } else {
      console.warn('🤔 المتصفح لا يدعم Service Worker.');
    }

    // ----------------------
    // 2. دعم iOS: إظهار تلميح التثبيت اليدوي
    // ----------------------
    const isIOS = /iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase());
    const isInStandaloneMode = ('standalone' in window.navigator) && window.navigator.standalone;
    if (isIOS && !isInStandaloneMode) {
      document.getElementById('iosInstallHint').style.display = 'block';
      console.log('🛠️ يظهر تلميح تثبيت خاص بـ iOS.');
    }

    // ----------------------
    // 3. التعامل مع زر التثبيت اليدوي (beforeinstallprompt)
    // ----------------------
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');

    // أضف مستمع الحدث قبل أي محاولة للنقر على الزر
    installBtn.addEventListener('click', async () => {
      console.log('👉 تم الضغط على زر التثبيت.');
      if (!deferredPrompt) {
        console.log('🚫 deferredPrompt فارغ، لا يمكن فتح نافذة التثبيت.');
        alert('التثبيت غير متوفر حالياً. جرّب لاحقاً من متصفح يدعم PWA.');
        return;
      }

      // افتح نافذة التثبيت الرسمية
      deferredPrompt.prompt();
      console.log('📤 تم استدعاء deferredPrompt.prompt().');

      const choice = await deferredPrompt.userChoice;
      console.log(`🧾 نتيجة التثبيت: ${choice.outcome}`); // "accepted" أو "dismissed"
      deferredPrompt = null;
      installBtn.style.display = 'none';
    });

    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('🎉 beforeinstallprompt تم إطلاقه.');
      e.preventDefault(); // منع الظهور التلقائي للنافذة الافتراضية
      deferredPrompt = e;
      installBtn.style.display = 'inline-block'; // إظهار الزر لمرة واحدة
    });

    window.addEventListener('appinstalled', () => {
      console.log('✅ تم تثبيت التطبيق بنجاح!');
      installBtn.style.display = 'none';
    });

    // ----------------------
    // 4. بيانات الطعام (foodData)
    // ----------------------
    const foodData = {
      "الافطار": [
        { name: "فطور مصري 4 اشخاص-الطلب بالحجز", price: "7000", image: "photos/breakfast/1_breakfast.jpg" },
        { name: "طبق كربوز", price: "5000", image: "photos/breakfast/2_breakfast.jpg" },
        { name: "اضافه خبز", price: "500", image: "photos/breakfast/3_breakfast.jpeg" },
        { name: "فاصوليا مع المقبلات", price: "1500", image: "photos/breakfast/4_breakfast.jpg" },
        { name: "طبق بهجه", price: "5000", image: "photos/breakfast/5_breakfast.jpg" },
        { name: "فرنش توست مع عصير فراوله", price: "1500", image: "photos/breakfast/6_breakfast.jpeg" },
        { name: "فرنش توست مع شاي", price: "1000", image: "photos/breakfast/7_breakfast.jpeg" },
        { name: "فطور تركي 4 اشخاص-الطلب بالحجز", price: "7000", image: "photos/breakfast/8_breakfast.jpg" },
        { name: "فطرو شامي 4 اشخاص - الطلب بالحجز", price: "7000", image: "photos/breakfast/9_breakfast.jpg" },
        { name: "بان كيك مع عصير فراوله", price: "1500", image: "photos/breakfast/11_breakfast.jpeg" },
        { name: "بان كيك مع شاي", price: "1000", image: "photos/breakfast/10_breakfast.jpeg" },
        { name: "بيض مع المقبلات", price: "1500", image: "photos/breakfast/12_breakfast.jpg" },
        { name: "خبز طاوه مع المقبلات و شاي", price: "1500", image: "photos/breakfast/13_breakfast.jpeg" },
        { name: "خبز طاوه مع المقبلات و شاي حليب", price: "1800", image: "photos/breakfast/14_breakfast.jpg" },
        { name: "مطيط", price: "1200", image: "photos/breakfast/15_breakfast.jpeg" },
        { name: "باخمري", price: "600", image: "photos/breakfast/16_1breakfast.jpg" },
        { name: "فطور 8 اشخاص-الطلب بالحجز", price: "15000", image: "photos/breakfast/16_breakfast.jpg" },
        { name: "مناقيش بالجبنه", price: "1000", image: "photos/breakfast/17.jpg" },
        { name: "مناقيش بالزعتر", price: "1200", image: "photos/breakfast/18.jpg" }
      ],

      "الساندويتشات": [
        { name: "ساندويتش زنجر", price: "2500", image: "photos/Sandwiches/1.jpg" },
        { name: "برجر دجاج", price: "1900", image: "photos/Sandwiches/2.png" },
        { name: "برجر دجاج وجبه", price: "2600", image: "" },
        { name: "بجرجر لحم", price: "2500", image: "photos/Sandwiches/3.png" },
        { name: "بجرجر لحم وجبه", price: "3200", image: "" },
        { name: "اضافه شبس", price: "600", image: "photos/Sandwiches/4.jpeg" },
        { name: "ساندويتش فاهيتا بخبز التوست", price: "1500", image: "photos/Sandwiches/5.jpg" },
        { name: "ساندويتش فاهيتا بخبز التورتيلا", price: "2000", image: "photos/Sandwiches/6.jpg" },
        { name: "ساندويتش فاهيتا بخبز البان", price: "1500", image: "photos/Sandwiches/7.jpg" },
        { name: "ساندويتش استربس دجاج بخبز التورتيلا", price: "2500", image: "photos/Sandwiches/9.jpg" },
        { name: "ساندويتش تونه بخبز البان", price: "1500", image: "" },
        { name: "ساندويتش تونه بخبز التوست", price: "1000", image: "" },
        { name: "ساندويتش ميني برجر لحم", price: "1300", image: "photos/Sandwiches/.jpeg" }
      ],

      "البيتزا": [
        { name: "بيتزا دجاج", price: "4000", image: "photos/pizza/1_pizza.jpeg" },
        { name: "بيتزا خضار", price: "3500", image: "photos/pizza/7.jpeg" },
        { name: "بيزا مرجريتا", price: "3000", image: "photos/pizza/3_pizza.jpeg" },
        { name: "بيزا نحيفة بصوص البيستو", price: "3500", image: "photos/pizza/4_pizza.jpg" },
        { name: "بان بيتزا", price: "3500", image: "photos/pizza/5_pizza.jpeg" },
        { name: "بيتزا محبي الجبنة", price: "3500", image: "photos/pizza/6.jpg" }
      ],

      "السلطات": [
        { name: "سلطه يونانيه", price: "700", image: "photos/Salads&Appetizers/1.jpg" },
        { name: "سلطه فتوش", price: "1000", image: "photos/Salads&Appetizers/2.jpeg" },
        { name: "سلطه جرجير", price: "1000", image: "photos/Salads&Appetizers/3.jpeg" }
      ],

      "الشوربات": [
        { name: "شوربة عدس", price: "1000", image: "photos/soups/1.jpg" },
        { name: "شوربة شوفان بالدجاج", price: "1100", image: "photos/soups/2.jpeg" },
        { name: "شوربة كريمه بالدجاج", price: "1300", image: "photos/soups/3.jpeg" }
      ],

      "الاطباق": [
        { name: "دجاج تايلاندي", price: "1800", image: "photos/maindeshes/1.jpg" },
        { name: "وجبه دجاج تايلاندي مع الكاجو", price: "3000", image: "photos/maindeshes/2.jpg" },
        { name: "تشكن ونجز بصوص البافلو", price: "2000", image: "photos/maindeshes/3.jpeg" },
        { name: "تشكن ونجز بالصوص الحار", price: "2000", image: "photos/maindeshes/4.jpg" },
        { name: "مكرونه حمراء مع الصوص", price: "1200", image: "photos/maindeshes/5.jpg" },
        { name: "مكرونه بيضاء", price: "2000", image: "photos/maindeshes/6.jpg" },
        { name: "مكرونه بصوص الجبنه", price: "1500", image: "photos/maindeshes/8.png" },
        { name: "استربس وجبة", price: "1500", image: "photos/maindeshes/10.jpg" },
        { name: "سلة شبس", price: "1200", image: "photos/maindeshes/9.jpeg" },
        { name: "وجبه بوب كورن دجاج (حار - عادي)", price: "2000", image: "photos/maindeshes/7.jpg" },
        { name: "بوب كورن دجاج (حار - عادي)", price: "1500", image: "photos/maindeshes/9.jpg" }
      ],

      "وجبات الاطفال": [
        { name: "مكرونه بصوص الجبنه", price: "2000", image: "photos/kidsfood/1.jpg" },
        { name: "اصابع جبنة", price: "2000", image: "photos/kidsfood/2.jpg" },
        { name: "ناجتس وجبه", price: "2000", image: "photos/kidsfood/3.jpg" },
        { name: "6 حبات ناجتس", price: "1000", image: "photos/kidsfood/4.jpg" }
      ],

      "الحلويات": [
        { name: "سويس رول بالشوكولاتة", price: "700", image: "photos/dessert/1.jpg" },
        { name: "كوكيز", price: "600", image: "photos/dessert/2.jpg" },
        { name: "حلا الكريب بالشوكولاتة", price: "2000", image: "photos/dessert/4.jpg" },
        { name: "10 حبات مني بان كيك بالشوكولاتة العسل", price: "1000", image: "photos/dessert/5.jpg" },
        { name: "5 حبات مني بان كيك بالشوكولاته والعسل", price: "500", image: "" },
        { name: "حلا الشعيرية", price: "500", image: "" },
        { name: "حلا الشعيرية", price: "600", image: "" },
        { name: "فشار", price: "600", image: "" },
        { name: "تشيزكيك لوتس (حسب الطلب)", price: "2000", image: "" },
        { name: "موس كيك (حسب الطلب)", price: "1600", image: "" },
        { name: "كيك غني بالشوكولاتة (حسب الطلب)", price: "800", image: "" },
        { name: "ايسكريم", price: "800", image: "photos/dessert/1_ice.jpg" }
      ],

      "المشروبات البارده": [
        { name: "سان شاين (توت ازرق, توت احمر, خوخ, فراوله, برتقال, عناب, ليمون مع نعناع)", price: "1000", image: "photos/colddrinks/1.jpg" },
        { name: "سان باور شاين (توت ازرق, توت احمر, خوخ, فراوله, برتقال, عناب, ليمون مع نعناع)", price: "1400", image: "photos/colddrinks/2.jpg" },
        { name: "عصير سان توب", price: "300", image: "" },
        { name: "عصير سن كويك", price: "500", image: "" },
        { name: "مشروب غازي", price: "400", image: "" },
        { name: "ماء", price: "300", image: "" },
        { name: "ايس موكا", price: "1200", image: "" },
        { name: "ايس تي خوخ", price: "1000", image: "" },
        { name: "ورد لاتيه", price: "1700", image: "" },
        { name: "ورد مكس", price: "1500", image: "" },
        { name: "سبانش لاتيه", price: "1400", image: "" },
        { name: "ايس لاتيه (قهوة باردة)", price: "1200", image: "" },
        { name: "ايس فرباتشينو (كرامل - شوكولاتة)", price: "1400", image: "" },
        { name: "كراميل لاتيه", price: "1200", image: "" },
        { name: "عصير فراولة", price: "1000", image: "photos/colddrinks/2.jpg" },
        { name: "عصير فراولة طازجة", price: "1300", image: "" },
        { name: "عصير فراولة بالحليب", price: "1200", image: "" },
        { name: "عصير زبيب أسود", price: "1500", image: "" },
        { name: "عصير منجو", price: "1200", image: "" },
        { name: "عصير منجو بالحليب", price: "1400", image: "" },
        { name: "عصير موز", price: "600", image: "" },
        { name: "عصير موز بالحليب", price: "600", image: "" },
        { name: "عصير كركديه", price: "600", image: "" },
        { name: "عصير مكس كركديه", price: "1000", image: "" },
        { name: "عصير حبّيب", price: "1200", image: "" },
        { name: "عصير برتقال", price: "1200", image: "" },
        { name: "عصير ليمون", price: "1200", image: "" }
      ],

      "المشروبات الساخنة": [
        { name: "كابتشينو", price: "1000", image: "photos/hotdrinks/1.jpg" },
        { name: "كراميل لاتيه", price: "1200", image: "" },
        { name: "شوكولاتة ساخنة", price: "1000", image: "" },
        { name: "موكا ساخنة", price: "1200", image: "" },
        { name: "لاتيه ساخنة", price: "1000", image: "" },
        { name: "اسبريسو رومانيو", price: "1000", image: "" },
        { name: "اسبريسو", price: "1000", image: "" },
        { name: "امريكانو", price: "1000", image: "" },
        { name: "نيسكافي بالحليب", price: "900", image: "" },
        { name: "شاي حليب", price: "600", image: "" },
        { name: "شاي أحمر", price: "400", image: "" },
        { name: "شاي أخضر", price: "400", image: "" },
        { name: "قهوة تركي", price: "700", image: "" },
        { name: "بن ساده", price: "700", image: "" },
        { name: "بن حليب", price: "600", image: "" }
      ],

      "الشيش": [
        { name: "شيشة ورد", price: "4000", image: "photos/sheshah/1.jpg" },
        { name: "شيشة الندى", price: "4000", image: "" },
        { name: "شيشة مكس", price: "3500", image: "" },
        { name: "شيشة مكس بنكهتين", price: "4000", image: "" },
        { name: "شيشة نكهات", price: "3000", image: "" },
        { name: "شيشة شموخ", price: "4000", image: "" }
      ]
    };

    // ----------------------
    // 5. دالة البحث في قائمة الطعام
    // ----------------------
    function search() {
      const query = document.getElementById('searchInput').value.trim();
      const container = document.getElementById('food-list');
      container.innerHTML = '';
      if (!query) {
        alert("الرجاء إدخال كلمة للبحث");
        return;
      }

      let resultsFound = false;
      const maxPrice = !isNaN(query) ? parseFloat(query) : null;

      for (const category in foodData) {
        foodData[category].forEach(item => {
          const itemName = item.name || "";
          const itemPrice = parseFloat(item.price) || 0;
          const matchesName = itemName.includes(query);
          const matchesPrice = maxPrice !== null && itemPrice <= maxPrice;

          if (matchesName || matchesPrice) {
            resultsFound = true;
            const card = document.createElement('div');
            card.className = 'food-card';
            card.innerHTML = `
              ${item.image ? `<img src="${item.image}" alt="${item.name}" onerror="this.style.display='none';">` : ""}
              <div class="food-info">
                <h4>${item.price} <span>${item.name}</span></h4>
                ${item.description ? `<p>${item.description}</p>` : ""}
              </div>
            `;
            container.appendChild(card);
          }
        });
      }

      if (!resultsFound) {
        container.innerHTML = `<p style="text-align:center; padding: 20px;">لا توجد نتائج تطابق "${query}"</p>`;
      }
    }

    // ----------------------
    // 6. دوال عرض المنتجات حسب التصنيف وتنقل الأقسام
    // ----------------------
    // الاستماع للنقر على أزرار التصنيفات
    const categoryButtons = document.querySelectorAll(".category");

    categoryButtons.forEach(button => {
      button.addEventListener("click", () => {
        // إزالة التحديد من الكل
        categoryButtons.forEach(btn => btn.classList.remove("selected"));
        // تحديد الزر الحالي
        button.classList.add("selected");

        // الحصول على اسم التصنيف (النص بعد السطر)
        const categoryText = button.innerText.split("\n")[1].trim();

        // عرض بيانات الطعام للتصنيف المحدد
        renderCategory(categoryText);
      });
    });

    // دالة عرض العناصر حسب التصنيف
    function renderCategory(categoryName) {
      const container = document.getElementById("food-list");
      container.innerHTML = "";

      if (!foodData[categoryName]) {
        container.innerHTML = "<p style='text-align:center;'>لا توجد عناصر في هذا القسم.</p>";
        return;
      }

      foodData[categoryName].forEach(item => {
        const card = document.createElement("div");
        card.className = "food-card";
        card.innerHTML = `
          ${item.image ? `<img src="${item.image}" alt="${item.name}" onerror="this.style.display='none';">` : ""}
          <div class="food-info">
            <h4>${item.price} <span>${item.name}</span></h4>
            ${item.description ? `<p>${item.description}</p>` : ""}
          </div>
        `;
        container.appendChild(card);
      });
    }

    // عرض قسم الإفطار افتراضيًا عند تحميل الصفحة
    window.onload = () => {
      renderCategory("الافطار");
      console.log('🛠️ الصفحة حملت وعرضت قسم الافطار.');
    };
  </script>
</body>
</html>
